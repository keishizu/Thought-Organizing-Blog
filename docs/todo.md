# 📝 個人ブログサイト制作 ToDoリスト（最新版）

## フェーズ1：企画・要件定義
- [x] サイトの目的を明確化（思考整理 × 雑記型でアフィリエイト収益を狙う）
- [x] 想定ユーザー／読者のペルソナを定義（内省・行動変容に関心のある読者）
- [x] 収益導線の方向性を明確にする（書評・ツール紹介・自己分析支援など）
- [x] サイト構成案を作成（TOP／図書一覧／図書詳細／管理者ページなど）
- [x] 要件定義書を作成する

---

## フェーズ2：技術選定・基盤構築
- [x] 使用技術の決定（Next.js, Tailwind CSS, Supabaseなど）
- [x] GitHubリポジトリ作成
- [x] ローカル開発環境セットアップ（Cursor利用）
- [x] Supabase MCPとの連携設定（Cursor経由）
- [x] `rules` ディレクトリを作成し、プロジェクトルールファイルを設置（Cursor用）
- [x] `doc` ディレクトリを作成し、要件定義書・テーブル設計書などの保管スペースを準備

---

## フェーズ3：公開ページの実装（UI）
- [x] トップページ実装（サイト概要、図書一覧、など）
- [x] 図書一覧ページの実装
- [x] 図書詳細ページ実装（Markdown or HTML表示対応）
- [x] このサイトについての詳細ページ実装
- [x] Vercel開発環境へのデプロイ確認（UIの表示テスト）

---

## フェーズ4：DBテーブル設計（Supabase）
- [x] 図書テーブル `posts` の設計・作成（画像URL対応、検索対応、タグ・カテゴリー設計済）
- [x] コメントテーブル `comments` の設計・作成（匿名投稿／管理者削除対応）
- [x] 外部キー／インデックス設計（GINインデックス・CASCADE削除など）
- [x] Supabase RLSポリシー設計（管理者限定操作／匿名投稿許可など）
- [x] TypeScript型定義の生成

---

## フェーズ5：認証・アクセス制御（Supabase Auth）
- [x] Supabase Auth によるログイン機能の導入
- [x] 認証は管理者（自分）に限定／他ユーザーはログイン不可に設定
- [x] 認証状態による画面制御（ログイン画面／管理ページなど）

---

## フェーズ6：図書管理機能の実装（UI & CRUD）

- [x] 投稿・更新・削除のバリデーション処理  
  - `postFormSchema` による Zod バリデーション済み

- [x] Markdownまたはリッチテキスト対応のエディター導入（例：TipTap）  
  - `TipTapEditor` を導入し、本文入力に使用済み

- [x] 管理者ページ（図書投稿／編集／削除）画面の実装  
  - [x] 投稿画面 `/admin/posts/new`（PostForm使用可）  
  - [x] 編集画面 `/admin/posts/[id]/edit`（初期値読み込み＋更新処理 実装済み）  
  - [x] 一覧画面 `/admin/posts`（図書一覧・編集・削除ボタン UI 実装済み）  
  - [x] 削除機能の実装（Supabase `delete` 処理済み／ローカルストレージ側の削除も実装済み）

- [x] ローカルストレージ画像アップロード機能の実装  
  - [x] `ImageUpload.tsx` によるアップロードUI完成  
  - [x] `/api/upload-image` API エンドポイントの実装（ローカルストレージ版）
  - [x] 画像リサイズ機能の実装
  - [x] ファイルサイズ・形式チェック機能の実装

- [x] posts への新規登録処理（画像URL含む）  
  - [x] `PostForm.tsx` の `onSubmit()` 経由で Supabase に `insert`  
  - [x] 投稿完了時に `/admin/posts` へリダイレクト  
  - [x] エラー時にトースト表示（`use-toast.ts` 使用済み）

- [x] いいね、コメント機能の実装（Supabase + RLS対応）  
  - [x] UI側のリアクションコンポーネント設計（`PostInteractions.tsx` 実装済み）
  - [x] Supabase側の `likes`, `comments` テーブルと RLS 設定（実装済み）
  - [x] いいね機能のAPI実装（`/api/likes` 実装済み）
  - [x] コメント機能のAPI実装（`/api/comments` 実装済み）
  - [x] 匿名ユーザー対応（いいね・コメント機能で匿名ID生成済み）

- [x] オススメ図書管理機能の実装  
  - [x] 投稿／編集画面に「おすすめ図書に設定」トグルを追加  
  - [x] 設定済みオススメ図書が3件以上ある場合、トグルをオンにするとトーストでエラーを表示  
  - [x] 図書一覧画面 `/admin/posts` にて、オススメ図書には ★ マークを表示（視覚的に区別）  
  - [x] Supabase `posts` テーブルに `is_recommended: boolean` カラムを追加  
  - [x] トップページの「おすすめ図書」セクションに `is_recommended = true` の図書を最大3件表示

- [x] 画像削除機能の実装
  - [x] `/api/delete-image` API エンドポイントの実装
  - [x] 図書削除時の画像自動削除機能
  - [x] 図書編集時の古い画像削除機能

- [x] プレビュー機能の実装
  - [x] 図書投稿・編集画面でのプレビュー機能
  - [x] プレビューページ `/admin/posts/preview` の実装

- [x] プロフィール画像管理機能の実装
  - [x] `/api/upload-profile-image` API エンドポイントの実装
  - [x] `/api/delete-profile-image` API エンドポイントの実装
  - [x] 管理者アカウントページでのプロフィール画像管理機能

- [x] アカウント管理機能の実装
  - [x] アカウント管理画面 `/admin/account` の実装
  - [x] 管理者名の編集・更新機能（Supabase Auth user_metadata対応）
  - [x] プロフィール画像のアップロード・表示機能
  - [x] アカウント情報の表示（メールアドレス、最終ログイン日時）
  - [x] 管理者ダッシュボードからのアカウント管理画面への導線

---

## フェーズ7：本番デプロイ（Vercel）
- [ ] サイト内の文言を再確認し、適切な表現に変更する
- [ ] 記事の作成（最低５枚）
<!-- - [ ] 独自ドメインを取得（必要に応じて） -->
- [ ] Vercelにて本番用プロジェクトを作成
- [ ] Vercel側で環境変数を設定（Supabase関連）
- [ ] 本番ドメインのSSL設定確認
- [ ] Supabase Auth本番設定の確認（redirect URLなど）
- [ ] メタ情報の追加（タイトル・ディスクリプション・OGP対応）
  - [ ] 個別ページのメタ情報設定（図書詳細、プロフィール、図書一覧、カテゴリーページ）
  - [ ] OGP画像の設定（デフォルト画像、図書別画像）
  - [ ] Twitter Card対応

---

## フェーズ8：分析・収益導線強化
- [ ] Google Analytics導入（PV分析）
- [ ] Google Search Console登録・サイトマップ送信
- [ ] アフィリエイトリンク／図書下CTAの導線設計
- [ ] SNSや外部メディアとの連携設計（X, noteなど）

---

## フェーズ9：検索＆回遊導線の実装（おまけ）
- [ ] トップページに検索フォーム設置（自由入力対応）
- [ ] `/search?q=キーワード` の検索結果ページ実装
- [ ] タグクリック時に `/tags/[slug]` に遷移するタグ別一覧ページ実装
- [ ] タグ付き図書のフィルタ＆導線の最適化
- [ ] （任意）タグクラウド or 人気タグ表示UIの検討
